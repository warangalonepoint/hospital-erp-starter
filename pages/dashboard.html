<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard • Hospital ERP</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Banner -->
  <header class="banner">
    <div class="brand">
      <span class="brand-mark">🏥</span>
      <span class="brand-title">Hospital ERP</span>
    </div>
    <button id="themeToggle" class="toggle" title="Toggle theme">🌙</button>
  </header>

  <!-- Toolbar -->
  <nav class="toolbar">
    <a class="chip" href="index.html">← Home</a>
    <button id="btnLogout" class="chip">Logout</button>
    <button id="btnClear" class="chip">Clear Cache</button>
  </nav>

  <!-- Dashboard -->
  <main class="section">
    <div class="card-grid">
      <!-- Analytics -->
      <a class="card grad-purple" href="analytics.html">
        <h2>Analytics</h2>
        <p>Sales KPIs & Weekly Reports</p>
      </a>

      <!-- Bookings -->
      <a class="card grad-mint" href="booking-status.html">
        <h2>Bookings</h2>
        <p>Today · Week · Month counts</p>
      </a>

      <!-- Pharmacy -->
      <a class="card grad-sky" href="pharmacy.html">
        <h2>Pharmacy</h2>
        <p>
          Today <b id="phToday">₹0.00</b> ·
          MTD <b id="phMTD">₹0.00</b>
        </p>
      </a>

      <!-- Patients -->
      <a class="card grad-rose" href="patients.html">
        <h2>Patients</h2>
        <p><b id="dueToday">0</b> due today</p>
      </a>

      <!-- Staff -->
      <a class="card grad-peach" href="staff.html">
        <h2>Staff</h2>
        <p>Roster & Attendance</p>
      </a>

      <!-- Settings -->
      <a class="card grad-lavender" href="settings.html">
        <h2>Settings</h2>
        <p>Manage Staff, Patients & System</p>
      </a>
    </div>
  </main>

  <script src="utils.js"></script>
  <script>
    // Theme toggle
    (function(){
      const root=document.documentElement, btn=document.getElementById('themeToggle');
      const saved=localStorage.getItem('theme')||'light';
      root.dataset.theme=saved;
      btn.textContent=saved==='dark'?'🌙':'🌞';
      btn.onclick=()=>{
        const next=root.dataset.theme==='dark'?'light':'dark';
        root.dataset.theme=next;
        localStorage.setItem('theme',next);
        btn.textContent=next==='dark'?'🌙':'🌞';
      };
    })();

    // Logout
    document.getElementById('btnLogout').onclick=()=>{
      localStorage.clear();
      location.href='login.html';
    };

    // Clear Cache
    document.getElementById('btnClear').onclick=async()=>{ await ERP.hardClear(); };

    // Fill pharmacy + patients data if LS available
    (()=>{
      const invoices=ERP.load('invoices',[]);
      const items=ERP.load('invoice_items',[]);
      const patients=ERP.load('patients',[]);

      const todayISO=ERP.todayISO();
      const invToday=ERP.filterInvoicesByDate(invoices,todayISO,todayISO);
      const kpiToday=ERP.buildSalesKPIs(invToday,items);
      document.getElementById('phToday').textContent=ERP.formatMoney(kpiToday.total);

      const firstOfMTD=new Date(); firstOfMTD.setDate(1);
      const invMTD=ERP.filterInvoicesByDate(invoices,firstOfMTD,new Date());
      const kpiMTD=ERP.buildSalesKPIs(invMTD,items);
      document.getElementById('phMTD').textContent=ERP.formatMoney(kpiMTD.total);

      const due=patients.filter(p=>{
        const d=p.next_followup||p.next_visit||p.followup||'';
        return d && ERP.ymd(d)===todayISO;
      }).length;
      document.getElementById('dueToday').textContent=due;
    })();
  </script>
</body>
</html>
