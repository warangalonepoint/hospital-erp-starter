<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Select Role</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=30"/>
  <style>
    .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{max-width:520px;width:100%;border-radius:16px;padding:20px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);background:var(--card-bg)}
    .title{margin:0 0 8px 0}
    .subtitle{color:var(--muted);margin:0 0 16px 0}
    .tabs{display:flex;gap:10px;flex-wrap:wrap}
    .tab{height:44px;display:inline-flex;align-items:center;justify-content:center;padding:0 18px;border-radius:999px;background:var(--card-bg);border:1px solid rgba(0,0,0,.08);cursor:pointer;font-weight:700}
    .misc{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:8px;flex-wrap:wrap}
    .chip{height:40px;padding:0 14px;border-radius:999px;background:var(--card-bg);border:1px solid rgba(0,0,0,.06);cursor:pointer}
    .center{display:flex;justify-content:center;margin-top:10px}
  </style>
</head>
<body>
  <header class="banner">
    <button id="themeToggle" class="chip floating-toggle" aria-label="Theme">ðŸŒ™</button>
  </header>

  <div class="wrap">
    <div class="card">
      <h1 class="title">Choose Role</h1>
      <p class="subtitle">No PIN/password for now â€” pick a role to continue.</p>

      <div class="tabs">
        <button class="tab" data-role="doctor">Doctor</button>
        <button class="tab" data-role="supervisor">Supervisor</button>
        <button class="tab" data-role="admin">Admin</button>
      </div>

      <div class="misc">
        <span id="whoami" class="chip" style="pointer-events:none">Role: Guest</span>
        <button id="clearCacheBtn" class="chip">Clear Cache</button>
      </div>

      <div class="center">
        <a class="chip" href="dashboard.html">Go to Dashboard</a>
      </div>
    </div>
  </div>

  <script type="module">
    // Theme
    const tt=document.getElementById('themeToggle');
    if(localStorage.theme){document.documentElement.dataset.theme=localStorage.theme;tt.textContent=localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™'}
    tt.onclick=()=>{const cur=document.documentElement.dataset.theme||'light';const nxt=cur==='light'?'dark':'light';document.documentElement.dataset.theme=nxt;localStorage.theme=nxt;tt.textContent=nxt==='light'?'ðŸŒž':'ðŸŒ™'}

    // Utility
    const who=document.getElementById('whoami');
    const ses=JSON.parse(localStorage.getItem('session')||'{}');
    if(who) who.textContent = ses.role ? `Role: ${ses.role}` : 'Role: Guest';

    clearCacheBtn.onclick=async()=>{ localStorage.clear(); if('caches'in window){const ks=await caches.keys(); await Promise.all(ks.map(k=>caches.delete(k)))}; location.reload() }

    function setRole(role){
      const session = {role, name: role.toUpperCase(), loggedInAt: new Date().toISOString()};
      localStorage.setItem('session', JSON.stringify(session));
      if(role==='doctor')        location.href='dashboard.html';
      else if(role==='supervisor')location.href='supervisor.html';
      else if(role==='admin')     location.href='admin.html';
      else                        location.href='dashboard.html';
    }
    document.querySelectorAll('.tab').forEach(b=>b.onclick=()=>setRole(b.dataset.role));

    if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}) }
  </script>
</body>
</html>
