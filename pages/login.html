<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PIN Login ¬∑ Hospital ERP</title>
  <!-- Adjust the path to your styles.css if needed -->
  <link rel="stylesheet" href="./styles.css" />
  <style>
    /* Small page-specific touches (keeps your main styles.css as the source of truth) */
    .auth-wrap{max-width:740px;margin:12px auto;padding:0 12px;}
    .auth-card{background:var(--card-bg);box-shadow:var(--shadow);border-radius:18px;padding:18px;}
    .pin-input{font-size:22px;letter-spacing:2px;}
    .role-badge{display:inline-block;margin-left:6px;padding:4px 10px;border-radius:999px;background:var(--t-blue);color:var(--c-blue);font-weight:700}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 10px 24px rgba(0,0,0,.22);display:none;z-index:999}
    html[data-theme="dark"] .toast{background:#0b1220}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .row .grow{flex:1}
    .muted-small{color:var(--muted);font-size:.95rem}
    .logo {background:#ffffff;border-radius:18px;box-shadow:var(--shadow);padding:10px}
    .topbar {display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 12px 8px}
    .toggle {width:44px;height:44px;border-radius:50%;display:grid;place-items:center;background:rgba(255,255,255,.92);border:1px solid rgba(0,0,0,.06);cursor:pointer}
  </style>
</head>
<body>
  <!-- Banner / Brand -->
  <header class="topbar">
    <div class="logo">
      <img src="./assets/abhaya-logo.png" alt="ABHAYA Hospital" style="height:56px;display:block" onerror="this.style.display='none'">
      <div style="font-weight:800;font-size:26px;letter-spacing:.5px">ABHAYA HOSPITAL</div>
    </div>
    <button id="themeToggle" class="toggle" title="Toggle dark / light">üåô</button>
  </header>

  <!-- Fixed actions row -->
  <nav class="fixed-actions">
    <a class="chip" href="./index.html">‚Üê Dashboard</a>
    <button id="clearCache" class="chip">Clear Cache</button>
  </nav>

  <!-- Auth card -->
  <main class="auth-wrap">
    <section class="section auth-card">
      <h1 style="font-size:32px;margin-bottom:6px">PIN Login</h1>
      <p class="muted-small">Enter your 4‚Äì6 digit PIN to continue.</p>

      <div class="row mt16">
        <div class="grow">
          <label for="pin" class="muted">PIN</label>
          <div class="row">
            <input id="pin" type="password" inputmode="numeric" autocomplete="one-time-code"
                   class="pin-input grow" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" />
            <button id="toggleEye" class="chip" title="Show/Hide">üëÅÔ∏è</button>
          </div>
        </div>
      </div>

      <div class="row mt16">
        <button id="loginBtn" class="btn">Login</button>
        <span id="currentRole" class="role-badge" style="display:none"></span>
      </div>

      <div class="section mt16" style="background:linear-gradient(135deg,var(--t-lilac),#d7f0ff);">
        <h3 style="margin-bottom:8px;">Demo PINs</h3>
        <p class="muted-small">
          Doctor: <b>4321</b> &nbsp;‚Ä¢&nbsp; Supervisor: <b>1111</b> &nbsp;‚Ä¢&nbsp; Admin: <b>9999</b>
        </p>
      </div>

      <div class="section mt16">
        <h3 style="margin-bottom:8px;">Having trouble?</h3>
        <ol class="muted-small" style="padding-left:18px">
          <li>Tap <b>Clear Cache</b> to reset saved PINs and role.</li>
          <li>Reload the page and use one of the demo PINs above.</li>
        </ol>
      </div>
    </section>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    /* ---------- Theme ---------- */
    (function initTheme() {
      const key = 'theme';
      const saved = localStorage.getItem(key) || 'light';
      document.documentElement.setAttribute('data-theme', saved);
      const btn = document.getElementById('themeToggle');
      const updateIcon = () => btn.textContent = (document.documentElement.dataset.theme === 'dark') ? 'üåû' : 'üåô';
      updateIcon();
      btn.addEventListener('click', () => {
        const cur = document.documentElement.dataset.theme;
        const next = (cur === 'dark') ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem(key, next);
        updateIcon();
      });
    })();

    /* ---------- Helpers ---------- */
    const $ = (id) => document.getElementById(id);
    const toast = (msg, ms=1800) => {
      const t = $('toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__t_toast);
      window.__t_toast = setTimeout(()=> t.style.display='none', ms);
    };

    /* ---------- Default PINs (first run) ---------- */
    (function seedPins() {
      if (!localStorage.getItem('pin_doctor'))     localStorage.setItem('pin_doctor', '4321');
      if (!localStorage.getItem('pin_supervisor')) localStorage.setItem('pin_supervisor', '1111');
      if (!localStorage.getItem('pin_admin'))      localStorage.setItem('pin_admin', '9999');
    })();

    /* ---------- Login logic ---------- */
    function roleForPin(pin) {
      if (pin === localStorage.getItem('pin_admin'))      return 'admin';
      if (pin === localStorage.getItem('pin_supervisor')) return 'supervisor';
      if (pin === localStorage.getItem('pin_doctor'))     return 'doctor';
      return null;
    }

    function goTarget() {
      const url = new URL(location.href);
      const go  = url.searchParams.get('go') || 'index.html'; // default landing page
      location.href = go;
    }

    function doLogin() {
      const pin = $('pin').value.trim();
      if (!pin) { toast('Enter PIN'); return; }
      const role = roleForPin(pin);
      if (!role) { toast('Invalid PIN'); return; }
      localStorage.setItem('role', role);
      localStorage.setItem('logged_in_at', String(Date.now()));
      $('currentRole').style.display = 'inline-block';
      $('currentRole').textContent = role.toUpperCase();
      toast(`Welcome, ${role}`);
      setTimeout(goTarget, 400);
    }

    $('loginBtn').addEventListener('click', doLogin);
    $('pin').addEventListener('keydown', (e)=> { if (e.key === 'Enter') doLogin(); });

    $('toggleEye').addEventListener('click', () => {
      const i = $('pin');
      i.type = (i.type === 'password') ? 'text' : 'password';
      $('toggleEye').textContent = (i.type === 'password') ? 'üëÅÔ∏è' : 'üôà';
      i.focus();
    });

    $('clearCache').addEventListener('click', () => {
      // Keep theme preference; clear everything else
      const theme = localStorage.getItem('theme') || 'light';
      localStorage.clear();
      localStorage.setItem('theme', theme);
      toast('Cache cleared');
    });

    // If already logged in, hint the role
    (function showExistingRole(){
      const r = localStorage.getItem('role');
      if (r) { $('currentRole').style.display='inline-block'; $('currentRole').textContent = r.toUpperCase(); }
    })();
  </script>
</body>
</html>
