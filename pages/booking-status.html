<!doctype html>

<html lang="en" data-theme="light">  
<head>  
  <meta charset="utf-8"/>  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>  
  <title>Booking Status ‚Äì Doctor</title>  
  <link rel="manifest" href="manifest.webmanifest"/>  
  <link rel="icon" href="assets/logo.png"/>  
  <link rel="stylesheet" href="styles.css?v=25"/>  
  <style>  
    .section{margin:12px}  
    .tint{border-radius:16px;padding:16px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06)}  
    .tint-blue{background: color-mix(in srgb, #2563eb 16%, var(--card-bg))}  
    .tint-mint{background: color-mix(in srgb, #22c55e 14%, var(--card-bg))}  
    .tint-peach{background: color-mix(in srgb, #fb923c 14%, var(--card-bg))}  
    .kpi-grid{display:grid;gap:14px;grid-template-columns:repeat(3,1fr)}  
    @media (max-width:760px){.kpi-grid{grid-template-columns:1fr}}  
    .kpi{border-radius:16px;padding:16px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06)}  
    .kpi h4{font-size:14px;opacity:.85;margin-bottom:6px}  
    .kpi .num{font-size:32px;font-weight:800}  
    .filters{display:flex;gap:10px;flex-wrap:wrap}  
    .chip{height:40px;padding:0 14px;border-radius:999px;background:var(--card-bg);border:1px solid rgba(0,0,0,.06)}  
    .chart-card{border-radius:16px;padding:16px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06)}  
    canvas{width:100%;height:280px}  
    .muted{color:var(--muted);font-size:13px}  
  </style>  
</head>  
<body>  
  <!-- Banner -->  
  <header class="banner">  
    <button id="themeToggle" class="chip floating-toggle" aria-label="Theme">üåô</button>  
  </header>    <!-- Actions -->    <nav class="fixed-actions">  
    <a class="chip" href="dashboard.html">‚Üê Dashboard</a>  
    <button id="logoutBtn" class="chip">Logout</button>  
    <button id="clearCacheBtn" class="chip">Clear Cache</button>  
  </nav>    <!-- KPIs -->    <section class="section">  
    <div class="kpi-grid">  
      <div class="kpi tint-blue">  
        <h4>Today</h4>  
        <div class="num" id="kToday">0</div>  
        <div class="muted" id="lblToday"></div>  
      </div>  
      <div class="kpi tint-mint">  
        <h4>This Week</h4>  
        <div class="num" id="kWeek">0</div>  
        <div class="muted" id="lblWeek"></div>  
      </div>  
      <div class="kpi tint-peach">  
        <h4>This Month</h4>  
        <div class="num" id="kMonth">0</div>  
        <div class="muted" id="lblMonth"></div>  
      </div>  
    </div>  
  </section>    <!-- Chart -->    <section class="section">  
    <div class="chart-card">  
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">  
        <h2>Bookings Trend</h2>  
        <div class="filters">  
          <button class="chip" data-range="7d">7D</button>  
          <button class="chip" data-range="30d">30D</button>  
          <button class="chip" data-range="90d">90D</button>  
        </div>  
      </div>  
      <canvas id="trend"></canvas>  
      <div class="muted" id="rangeLbl" style="margin-top:8px"></div>  
    </div>  
  </section>    <script src="assets/chart.umd.min.js"></script>    <script type="module">  
    // --- Theme  
    const tt=document.getElementById('themeToggle');  
    if(localStorage.theme){document.documentElement.dataset.theme=localStorage.theme;tt.textContent=localStorage.theme==='light'?'üåû':'üåô'}  
    tt.onclick=()=>{const cur=document.documentElement.dataset.theme||'light';const nxt=cur==='light'?'dark':'light';document.documentElement.dataset.theme=nxt;localStorage.theme=nxt;tt.textContent=nxt==='light'?'üåû':'üåô'}  
  
    // --- Guard: doctor only  
    const ses=JSON.parse(localStorage.getItem('session')||'{}');  
    if(ses.role!=='doctor'){location.replace('login.html')}  
  
    // --- Actions  
    logoutBtn.onclick=()=>{localStorage.removeItem('session');location.href='login.html'}  
    clearCacheBtn.onclick=async()=>{localStorage.clear();if('caches'in window){const ks=await caches.keys();await Promise.all(ks.map(k=>caches.delete(k)))};location.reload()}  
  
    // --- Data  
    const bookings=()=>JSON.parse(localStorage.getItem('bookings')||'[]'); // supervisor creates  
    const ISO=(d)=>new Date(d).toISOString().slice(0,10);  
    const today=ISO(new Date());  
    const weekStart=(()=>{const d=new Date();const n=(d.getDay()+6)%7;d.setDate(d.getDate()-n);d.setHours(0,0,0,0);return ISO(d)})();  
    const monthStart=ISO(new Date(new Date().getFullYear(), new Date().getMonth(), 1));  
    const inRange=(iso,a,b)=> iso>=a && iso<=b;  
  
    function computeKPIs(){  
      const all=bookings();  
      const t=all.filter(b=>b.date===today).length;  
      const w=all.filter(b=> inRange(b.date, weekStart, today)).length;  
      const m=all.filter(b=> inRange(b.date, monthStart, today)).length;  
      kToday.textContent=t; kWeek.textContent=w; kMonth.textContent=m;  
      lblToday.textContent=today;  
      lblWeek.textContent=weekStart+' ‚Üí '+today;  
      lblMonth.textContent=monthStart+' ‚Üí '+today;  
    }  
  
    // chart  
    let chart;  
    function renderChart(days=7){  
      const end=new Date(); const start=new Date(); start.setDate(end.getDate()-days+1);  
      const startISO=ISO(start); const endISO=ISO(end);  
      rangeLbl.textContent=startISO+' ‚Üí '+endISO;  
  
      const map={};  
      for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){  
        map[ISO(d)]=0;  
      }  
      bookings().forEach(b=>{ if(map[b.date]!=null) map[b.date]++ });  
  
      const labels=Object.keys(map);  
      const data=labels.map(k=>map[k]);  
  
      if(chart) chart.destroy();  
      chart=new Chart(document.getElementById('trend'),{  
        type:'line',  
        data:{labels, datasets:[{label:'Bookings', data, tension:.35}]},  
        options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}  
      });  
    }  
  
    // filters  
    document.querySelectorAll('.filters .chip').forEach(btn=>{  
      btn.onclick=()=>{  
        document.querySelectorAll('.filters .chip').forEach(x=>x.classList.remove('active'));  
        btn.classList.add('active');  
        const r=btn.dataset.range;  
        renderChart(r==='30d'?30:r==='90d'?90:7);  
      }  
    });  
  
    computeKPIs();  
    renderChart(7);  
  
    // SW  
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}) }  
  </script>  </body>  
</html>
